<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  class ChartFrame extends HTMLElement {
    static get observedAttributes() {
      return ['data-chart'];
    }

    constructor() {
      super();
      this.shadow = this.attachShadow({ mode: "open" });
      this.canvas = document.createElement("canvas");
      this.canvas.width = 400;
      this.canvas.height = 300;
      this.canvas.style.background = "#f0f0f0";
      this.shadow.appendChild(this.canvas);
    }

    attributeChangedCallback(name, oldValue, newValue) {
      if (name === 'data-chart') {
        const chartData = JSON.parse(newValue);
        setTimeout(() => this.renderChart(chartData), 300);
      }
    }

    renderChart(data) {
      const ctx = this.canvas.getContext("2d");

      if (!this.chart) {
        this.chart = new Chart(ctx, {
          type: 'line',
          data,
          options: {
            responsive: false,
            animation: false,
            scales: {
              y: { beginAtZero: true }
            }
          }
        });
      } else {
        this.chart.data = data;
        this.chart.update();
      }
    }
  }

  customElements.define('chart-frame', ChartFrame);
</script>
